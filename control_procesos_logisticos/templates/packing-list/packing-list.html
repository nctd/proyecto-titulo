{% extends 'base.html' %}

{% block content %}
<div class="container-xl">
    <!-- Page title -->
    <div class="page-header d-print-none">
        <div class="row align-items-center">
            <div class="col">
                <h2 class="page-title">
                    Packing List
                </h2>
            </div>
        </div>
    </div>
</div>
<div class="page-body">
    <div class="container-xl">
        <!-- Content here -->
        <div class="row row-cards">

            <div class="col-12">
                <div class="card">
                    <div class='card-header'>
                        <h3 class="card-title">Datos bulto</h3>
                    </div>
                    <form method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-4">
                                    <div class="mb-3">
                                        <label class="form-label">Orden de venta</label>
                                        <div class="input-group mb-2">
                                            <span class="input-group-text">
                                                OV
                                            </span>

                                            <input type="text" class="form-control" name="bulto_ov" id="bulto_ov">
                                        </div>


                                    </div>
                                </div>

                                <div class="col-xl-4 mb-3">
                                    <label class="form-label" style="visibility: hidden;">bt</label>
                                    <button class="btn btn-primary w-100" id='btn-agregar-ov' type="button">
                                        <!-- Download SVG icon from http://tabler-icons.io/i/search -->
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                            class="icon icon-tabler icon-tabler-plus" width="24" height="24"
                                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                            <line x1="12" y1="5" x2="12" y2="19"></line>
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                        </svg>
                                        Ingresar OV
                                    </button>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-4">
                                    <div class="mb-3">
                                        <label class="form-label">Tipo de bulto</label>
                                        <!-- <input type="text" class="form-control" name="bulto_input" id="bulto_input"> -->
                                        {{form_detalle.tipo_bulto}}
                                    </div>
                                </div>
                                <div class="col-lg-1">
                                    <div class="mb-3">
                                        <label class="form-label">Largo (mt)</label>
                                        {{form_detalle.largo}}
                                    </div>
                                </div>
                                <div class="col-lg-1">
                                    <div class="mb-3">
                                        <label class="form-label">Ancho (mt)</label>
                                        {{form_detalle.ancho}}
                                    </div>
                                </div>
                                <div class="col-lg-2">
                                    <div class="mb-3">
                                        <label class="form-label">Volumen (mt)</label>
                                        {{form_detalle.volumen}}
                                    </div>
                                </div>
                                <div class="col-lg-2">
                                    <div class="mb-3">
                                        <label class="form-label">Peso bruto (kg)</label>
                                        {{form_detalle.peso_bruto}}
                                    </div>
                                </div>
                                <div class="col-lg-2">
                                    <div class="mb-3">
                                        <label class="form-label">Peso neto (kg)</label>
                                        {{form_detalle.peso_neto}}
                                    </div>
                                </div>

                            </div>
                            <!-- </div> -->
                        </div>
                        <div class="card-header">
                            <h3 class="card-title">Contenido bulto</h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-1">
                                    <div class="mb-3">
                                        <label class="form-label">Línea</label>
                                        <input type="text" class="form-control" name="bulto_linea" id="bulto_linea">
                                    </div>
                                </div>
                                <div class="col-lg-2">
                                    <div class="mb-3">
                                        <label class="form-label">Código</label>
                                        <input type="text" class="form-control" name="bulto_codigo" id="bulto_codigo"
                                            style="background-color: #f1f5f9 !important" disabled>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="mb-3">
                                        <label class="form-label">Descripción</label>
                                        <input type="text" class="form-control" name="bulto_descripcion"
                                            id="bulto_descripcion" disabled>
                                    </div>

                                </div>
                                <div class="col-lg-1">
                                    <div class="mb-3">
                                        <label class="form-label">Cantidad</label>
                                        <input type="text" class="form-control" name="bulto_cantidad"
                                            id="bulto_cantidad">
                                    </div>
                                </div>
                                <div class="col-xl-4 mb-3">
                                    <label class="form-label" style="visibility: hidden;">bt</label>
                                    <button class="btn btn-primary w-100" id='btn-agregar-linea' type="button">
                                        <!-- Download SVG icon from http://tabler-icons.io/i/search -->
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                            class="icon icon-tabler icon-tabler-plus" width="24" height="24"
                                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                            <line x1="12" y1="5" x2="12" y2="19"></line>
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                        </svg>
                                        Agregar línea
                                    </button>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <div class="gridjs gridjs-container">
                                    <table class="gridjs-table" id='tabla-bulto'>
                                        <thead class="gridjs-thead">
                                            <tr class="gridjs-tr">
                                                <th class="gridjs-th gridjs-th-sort gridjs-th-fixed text-center"
                                                    style="width: 100px;">
                                                    LÍNEA</th>
                                                <th class=" gridjs-th gridjs-th-sort gridjs-th-fixed text-center"
                                                    style="width: 150px;">
                                                    CÓDIGO
                                                </th>
                                                <th class=" gridjs-th gridjs-th-sort gridjs-th-fixed text-center"
                                                    style="width: 400px;">
                                                    DESCRIPCIÓN
                                                </th>
                                                <th class=" gridjs-th gridjs-th-sort gridjs-th-fixed text-center"
                                                    style="width: 50px;">
                                                    CANTIDAD
                                                </th>
                                                <th class=" gridjs-th gridjs-th-sort gridjs-th-fixed text-center"
                                                    style="width: 100px;">
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody class=" gridjs-tbody" style="text-align: center;">

                                        </tbody>
                                    </table>
                                </div>

                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const e = document.getElementById('nav-item-packing')
    e.classList.add('active')

</script>

<script>
    $("#btn-agregar-ov").on('click', function (e) {
        if ($('#bulto_ov').val() != '') {
            var ov = 'OV' + document.getElementById('bulto_ov').value
            $.ajax({
                type: 'GET',
                url: "{% url 'validar_orden_pl' %}",
                data: {
                    'orden_venta': ov,
                },
                dataType: "json",
                success: function (response) {
                    document.getElementById('bulto_ov').disabled = true;
                }
            })
        } else {
            $('#bulto_ov').addClass('is-invalid');
            e.preventDefault()
        }
    })
</script>
<script>
    $("#bulto_linea").on('change', function (e) {
        alert('a')
        var ov = 'OV' + document.getElementById('bulto_ov').value
        var linea = document.getElementById('bulto_linea').value
        $.ajax({
            type: 'GET',
            url: "{% url 'obtener_articulo_pl' %}",
            data: {
                'orden_venta': ov,
                'linea': linea
            },
            dataType: "json",
            success: function (response) {
                alert(response)
                document.getElementById('bulto_codigo').value = response['codigo'];
                document.getElementById('bulto_descripcion').value = response['descripcion'];
            }
        })
    })
</script>
<script>
    $("#btn-agregar-linea").on('click', function (e) {

        if ($('#bulto_linea').val() == '' || $('#bulto_codigo').val() == '' || $('#bulto_descripcion').val() == '' || $('#bulto_cantidad').val() == '') {
            if ($('#bulto_linea').val() == '') {
                $('#bulto_linea').addClass('is-invalid');
            }
            // if ($('#bulto_codigo').val() == '') {
            //     $('#bulto_codigo').addClass('is-invalid');
            // }
            // if ($('#bulto_descripcion').val() == '') {
            //     $('#bulto_descripcion').addClass('is-invalid');
            // }
            if ($('#bulto_cantidad').val() == '') {
                $('#bulto_cantidad').addClass('is-invalid');
            }
        } else {
            $("#tabla-bulto").append(`<tr class="gridjs-tr">
                    <td class="gridjs-td">test</td>
                    <td class="gridjs-td">test</td>
                    <td class="gridjs-td">test</td>
                    <td class="gridjs-td">test</td>
                    <td class="gridjs-td">
                        <a class="btn btn-danger" onclick="eliminarFila()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-trash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                        <line x1="4" y1="7" x2="20" y2="7"></line>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                        <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"></path>
                        <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"></path>
                        </svg>
                        Borrar
                        </a>
                    </td>
                    </tr>`);
        }
    })
</script>
<script>
    $("#bulto_linea").on('click', function (e) {
        event.stopPropagation();
        $('#bulto_linea').removeClass("is-invalid");
    })
    $("#bulto_cantidad").on('click', function (e) {
        event.stopPropagation();
        $('#bulto_cantidad').removeClass("is-invalid");
    })
</script>
<script>
    function eliminarFila() {
        var td = event.target.parentNode;
        var tr = td.parentNode; // the row to be removed
        tr.parentNode.removeChild(tr);
    }
</script>
{% endblock %}